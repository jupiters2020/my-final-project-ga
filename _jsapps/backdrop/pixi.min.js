define("text", ["module"], function (e) {
  "use strict";
  function t(e, t) {
    return void 0 === e || "" === e ? t : e;
  }
  function a(e, a, i, o) {
    if (a === o) return !0;
    if (e === i) {
      if ("http" === e) return t(a, "80") === t(o, "80");
      if ("https" === e) return t(a, "443") === t(o, "443");
    }
    return !1;
  }
  var i,
    o,
    s,
    n,
    r,
    d = ["Msxml2.XMLHTTP", "Microsoft.XMLHTTP", "Msxml2.XMLHTTP.4.0"],
    m = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
    h = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
    l = "undefined" != typeof location && location.href,
    u = l && location.protocol && location.protocol.replace(/\:/, ""),
    c = l && location.hostname,
    _ = l && (location.port || void 0),
    f = {},
    p = (e.config && e.config()) || {};
  return (
    (i = {
      version: "2.0.16",
      strip: function (e) {
        if (e) {
          e = e.replace(m, "");
          var t = e.match(h);
          t && (e = t[1]);
        } else e = "";
        return e;
      },
      jsEscape: function (e) {
        return e
          .replace(/(['\\])/g, "\\$1")
          .replace(/[\f]/g, "\\f")
          .replace(/[\b]/g, "\\b")
          .replace(/[\n]/g, "\\n")
          .replace(/[\t]/g, "\\t")
          .replace(/[\r]/g, "\\r")
          .replace(/[\u2028]/g, "\\u2028")
          .replace(/[\u2029]/g, "\\u2029");
      },
      createXhr:
        p.createXhr ||
        function () {
          var e, t, a;
          if ("undefined" != typeof XMLHttpRequest) return new XMLHttpRequest();
          if ("undefined" != typeof ActiveXObject)
            for (t = 0; t < 3; t += 1) {
              a = d[t];
              try {
                e = new ActiveXObject(a);
              } catch (e) {}
              if (e) {
                d = [a];
                break;
              }
            }
          return e;
        },
      parseName: function (e) {
        var t,
          a,
          i,
          o = !1,
          s = e.lastIndexOf("."),
          n = 0 === e.indexOf("./") || 0 === e.indexOf("../");
        return (
          -1 !== s && (!n || s > 1)
            ? ((t = e.substring(0, s)), (a = e.substring(s + 1)))
            : (t = e),
          (i = a || t),
          (s = i.indexOf("!")),
          -1 !== s &&
            ((o = "strip" === i.substring(s + 1)),
            (i = i.substring(0, s)),
            a ? (a = i) : (t = i)),
          { moduleName: t, ext: a, strip: o }
        );
      },
      xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,
      useXhr: function (e, t, o, s) {
        var n,
          r,
          d,
          m = i.xdRegExp.exec(e);
        return (
          !m ||
          ((n = m[2]),
          (r = m[3]),
          (r = r.split(":")),
          (d = r[1]),
          (r = r[0]),
          (!n || n === t) &&
            (!r || r.toLowerCase() === o.toLowerCase()) &&
            ((!d && !r) || a(n, d, t, s)))
        );
      },
      finishLoad: function (e, t, a, o) {
        (a = t ? i.strip(a) : a), p.isBuild && (f[e] = a), o(a);
      },
      load: function (e, t, a, o) {
        if (o && o.isBuild && !o.inlineText) return void a();
        p.isBuild = o && o.isBuild;
        var s = i.parseName(e),
          n = s.moduleName + (s.ext ? "." + s.ext : ""),
          r = t.toUrl(n),
          d = p.useXhr || i.useXhr;
        if (0 === r.indexOf("empty:")) return void a();
        !l || d(r, u, c, _)
          ? i.get(
              r,
              function (t) {
                i.finishLoad(e, s.strip, t, a);
              },
              function (e) {
                a.error && a.error(e);
              }
            )
          : t(
              [n],
              function (e) {
                i.finishLoad(s.moduleName + "." + s.ext, s.strip, e, a);
              },
              function (e) {
                a.error && a.error(e);
              }
            );
      },
      write: function (e, t, a, o) {
        if (f.hasOwnProperty(t)) {
          var s = i.jsEscape(f[t]);
          a.asModule(
            e + "!" + t,
            "define(function () { return '" + s + "';});\n"
          );
        }
      },
      writeFile: function (e, t, a, o, s) {
        var n = i.parseName(t),
          r = n.ext ? "." + n.ext : "",
          d = n.moduleName + r,
          m = a.toUrl(n.moduleName + r) + ".js";
        i.load(
          d,
          a,
          function (t) {
            var a = function (e) {
              return o(m, e);
            };
            (a.asModule = function (e, t) {
              return o.asModule(e, m, t);
            }),
              i.write(e, d, a, s);
          },
          s
        );
      },
    }),
    "node" === p.env ||
    (!p.env &&
      "undefined" != typeof process &&
      process.versions &&
      process.versions.node &&
      !process.versions["node-webkit"] &&
      !process.versions["atom-shell"])
      ? ((o = require.nodeRequire("fs")),
        (i.get = function (e, t, a) {
          try {
            var i = o.readFileSync(e, "utf8");
            "\ufeff" === i[0] && (i = i.substring(1)), t(i);
          } catch (e) {
            a && a(e);
          }
        }))
      : "xhr" === p.env || (!p.env && i.createXhr())
      ? (i.get = function (e, t, a, o) {
          var s,
            n = i.createXhr();
          if ((n.open("GET", e, !0), o))
            for (s in o)
              o.hasOwnProperty(s) && n.setRequestHeader(s.toLowerCase(), o[s]);
          p.onXhr && p.onXhr(n, e),
            (n.onreadystatechange = function (i) {
              var o, s;
              4 === n.readyState &&
                ((o = n.status || 0),
                o > 399 && o < 600
                  ? ((s = new Error(e + " HTTP status: " + o)),
                    (s.xhr = n),
                    a && a(s))
                  : t(n.responseText),
                p.onXhrComplete && p.onXhrComplete(n, e));
            }),
            n.send(null);
        })
      : "rhino" === p.env ||
        (!p.env && "undefined" != typeof Packages && "undefined" != typeof java)
      ? (i.get = function (e, t) {
          var a,
            i,
            o = new java.io.File(e),
            s = java.lang.System.getProperty("line.separator"),
            n = new java.io.BufferedReader(
              new java.io.InputStreamReader(
                new java.io.FileInputStream(o),
                "utf-8"
              )
            ),
            r = "";
          try {
            for (
              a = new java.lang.StringBuffer(),
                i = n.readLine(),
                i &&
                  i.length() &&
                  65279 === i.charAt(0) &&
                  (i = i.substring(1)),
                null !== i && a.append(i);
              null !== (i = n.readLine());

            )
              a.append(s), a.append(i);
            r = String(a.toString());
          } finally {
            n.close();
          }
          t(r);
        })
      : ("xpconnect" === p.env ||
          (!p.env &&
            "undefined" != typeof Components &&
            Components.classes &&
            Components.interfaces)) &&
        ((s = Components.classes),
        (n = Components.interfaces),
        Components.utils.import("resource://gre/modules/FileUtils.jsm"),
        (r = "@mozilla.org/windows-registry-key;1" in s),
        (i.get = function (e, t) {
          var a,
            i,
            o,
            d = {};
          r && (e = e.replace(/\//g, "\\")), (o = new FileUtils.File(e));
          try {
            (a = s["@mozilla.org/network/file-input-stream;1"].createInstance(
              n.nsIFileInputStream
            )),
              a.init(o, 1, 0, !1),
              (i = s[
                "@mozilla.org/intl/converter-input-stream;1"
              ].createInstance(n.nsIConverterInputStream)),
              i.init(
                a,
                "utf-8",
                a.available(),
                n.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER
              ),
              i.readString(a.available(), d),
              i.close(),
              a.close(),
              t(d.value);
          } catch (e) {
            throw new Error(((o && o.path) || "") + ": " + e);
          }
        })),
    i
  );
}),
  define("text!pixelation/template.html", [], function () {
    return "";
  }),
  define("global_libs/require/normalize", [], function () {
    function e(e, i, o) {
      if (e.match(r) || e.match(n)) return e;
      e = s(e);
      var d = o.match(n),
        m = i.match(n);
      return !m || (d && d[1] == m[1] && d[2] == m[2])
        ? a(t(e, i), o)
        : t(e, i);
    }
    function t(e, t) {
      if (
        ("./" == e.substr(0, 2) && (e = e.substr(2)), e.match(r) || e.match(n))
      )
        return e;
      var a = t.split("/"),
        i = e.split("/");
      for (a.pop(); (curPart = i.shift()); )
        ".." == curPart ? a.pop() : a.push(curPart);
      return a.join("/");
    }
    function a(e, t) {
      var a = t.split("/");
      for (
        a.pop(), t = a.join("/") + "/", i = 0;
        t.substr(i, 1) == e.substr(i, 1);

      )
        i++;
      for (; "/" != t.substr(i, 1); ) i--;
      (t = t.substr(i + 1)), (e = e.substr(i + 1)), (a = t.split("/"));
      var o = e.split("/");
      for (out = ""; a.shift(); ) out += "../";
      for (; (curPart = o.shift()); ) out += curPart + "/";
      return out.substr(0, out.length - 1);
    }
    var o = /([^:])\/+/g,
      s = function (e) {
        return e.replace(o, "$1/");
      },
      n = /[^\:\/]*:\/\/([^\/])*/,
      r = /^(\/|data:)/,
      d = function (t, a, i) {
        (a = s(a)), (i = s(i));
        for (
          var o,
            n,
            t,
            r = /@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;
          (o = r.exec(t));

        ) {
          n = o[3] || o[2] || o[5] || o[6] || o[4];
          var d;
          d = e(n, a, i);
          var m = o[5] || o[6] ? 1 : 0;
          (t =
            t.substr(0, r.lastIndex - n.length - m - 1) +
            d +
            t.substr(r.lastIndex - m - 1)),
            (r.lastIndex = r.lastIndex + (d.length - n.length));
        }
        return t;
      };
    return (d.convertURIBase = e), (d.absoluteURI = t), (d.relativeURI = a), d;
  }),
  define("css", [], function () {
    if ("undefined" == typeof window)
      return {
        load: function (e, t, a) {
          a();
        },
      };
    var e = document.getElementsByTagName("head")[0],
      t =
        window.navigator.userAgent.match(
          /Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/
        ) || 0,
      a = !1,
      i = !0;
    t[1] || t[7]
      ? (a = parseInt(t[1]) < 6 || parseInt(t[7]) <= 9)
      : t[2] || t[8]
      ? (i = !1)
      : t[4] && (a = parseInt(t[4]) < 18);
    var o = {};
    o.pluginBuilder = "global_libs/require/css-builder";
    var s,
      n,
      r,
      d = function () {
        (s = document.createElement("style")),
          e.appendChild(s),
          (n = s.styleSheet || s.sheet);
      },
      m = 0,
      h = [],
      l = function (e) {
        m++,
          32 == m && (d(), (m = 0)),
          n.addImport(e),
          (s.onload = function () {
            u();
          });
      },
      u = function () {
        r();
        var e = h.shift();
        return e ? ((r = e[1]), void l(e[0])) : void (r = null);
      },
      c = function (e, t) {
        if (((n && n.addImport) || d(), n && n.addImport))
          r ? h.push([e, t]) : (l(e), (r = t));
        else {
          s.textContent = '@import "' + e + '";';
          var a = setInterval(function () {
            try {
              s.sheet.cssRules, clearInterval(a), t();
            } catch (e) {}
          }, 10);
        }
      },
      _ = function (t, a) {
        var o = document.createElement("link");
        if (((o.type = "text/css"), (o.rel = "stylesheet"), i))
          o.onload = function () {
            (o.onload = function () {}), setTimeout(a, 7);
          };
        else
          var s = setInterval(function () {
            for (var e = 0; e < document.styleSheets.length; e++) {
              if (document.styleSheets[e].href == o.href)
                return clearInterval(s), a();
            }
          }, 10);
        (o.href = t), e.appendChild(o);
      };
    return (
      (o.normalize = function (e, t) {
        return (
          ".css" == e.substr(e.length - 4, 4) &&
            (e = e.substr(0, e.length - 4)),
          t(e)
        );
      }),
      (o.load = function (e, t, i) {
        (a ? c : _)(t.toUrl(e + ".css"), i);
      }),
      o
    );
  }),
  define("css!pixelation/style", [], function () {}),
  define("pixelation/main", [
    "text!pixelation/template.html",
    "_libs/pixi.min",
    "css!./style",
  ], function (e, t) {
    return Backbone.View.extend({
      template: _.template(e),
      deferredLoadEventName: "pixelation-load-complete",
      defaults: {
        hex: "#000000",
        alpha: 0,
        mouse_interaction: !0,
        mouse_sensitivity: 6,
        image_url:
          "https://media.newyorker.com/photos/59c95cbbb8d85e34177b8ffb/master/w_2560%2Cc_limit/Costa-Ecstatic-Return-Two-Dances-Pina-Bausch.JPG",
        image: "",
        image_size: 1024,
        requires_webgl: "true",
        rows: 64,
        columns: 64,
        zoom: 100,
        horiz_stretch: 100,
        vert_stretch: 97,
        layout_mode: "grid_mode",
        grid_size: 44,
        flip_it: !1,
        elasticity: 35,
        stir_freq: 74,
        stir_strength: 4,
        stir_disorder: 76,
        tolerance: 86,
        mouse_zoom: 0,
        stir_grid: !0,
        posterize: !1,
        plugin_id: 23,
        size: "cover",
      },
      drawFrameID: null,
      initialize: function () {
        (this.image_load_queue = []),
          (this.data = {
            renderer: null,
            stage: null,
            texture: null,
            composition: null,
            sprites_num: 0,
            mouse_in: !1,
            image_size: { width: 100, height: 100 },
            row_num: 1,
            col_num: 1,
            mouse_vector: [
              { x: 0, y: 0 },
              { x: 0, y: 0 },
            ],
            texture_size: { width: 100, height: 100 },
            is_mobile: !1,
            image_loaded: !1,
            model_speed: { x: 0, y: 0 },
            lastClientPos: { x: 0, y: 0 },
            skip_delta: !1,
            mouse_sensitivity: 0,
            backdrop_size: { w: 800, h: 600, top: 0, left: 0, resolution: 1 },
            movement_offset: { x: 0, y: 0 },
            mouse_prev: { x: -1, y: -1 },
            mouse_cur: { x: 0, y: 0 },
            mouse_cache: { x: 0, y: 0 },
            mouse_delta: { x: 0, y: 0, smooth_x: 0, smooth_y: 0, long_tail: 0 },
          });
        var e = _.defaults(this.model.get("data"), this.defaults);
        this.model.set("data", e),
          this.listenTo(this.model, "reset", this.Init),
          (this.scrollCallback = this.updateScroll.bind(this)),
          (this.mouseCallback = this.updateMouseOffset.bind(this)),
          (this.mouseEnterCallback = this.mouseEnter.bind(this)),
          (this.mouseLeaveCallback = this.mouseLeave.bind(this));
      },
      render: function () {
        var e = Cargo.Core.Handlebars.Render("{{>loading_animation}}", {});
        return this.$el.html(e), this;
      },
      loadImage: function () {
        $(".loading_animation", this.el).removeClass("hidden");
        var e = this.model.get("data"),
          a = this,
          i = Cargo.Collection.Images.fetchWebGLImage(
            e.image,
            this.defaults.image_size
          );
        i
          ? (i.id = e.image)
          : ((i = { w: 1500, h: 1500, url: this.defaults.image_url, id: 0 }),
            (e.image = 0),
            this.model.set("data", e));
        var o = new Image();
        (o.crossOrigin = ""),
          (this.data.image_loaded = !1),
          this.image_load_queue.push(i.id),
          (o.onload = function () {
            if (!a.destroyed) {
              var e = a.image_load_queue.pop();
              if (a.model.get("data").image != e) return void a.loadImage();
              e == i.id &&
                ((a.image_load_queue = []),
                (a.data.image_size.width = parseInt(i.w)),
                (a.data.image_size.height = parseInt(i.h)),
                (a.data.texture_size = { width: o.width, height: o.height }),
                (a.data.texture = new t.Texture.fromImage(o.src)),
                (a.data.image_loaded = !0),
                a.updateWindow(!0),
                a.makeSprites());
            }
          }),
          (o.src = i.url);
      },
      isPowerOfTwo: function (e) {
        return 0 == (e & (e - 1));
      },
      nextHighestPowerOfTwo: function (e) {
        --e;
        for (var t = 1; t < 32; t <<= 1) e |= e >> t;
        return Math.min(e + 1, 1024);
      },
      makeSprites: function () {
        var e,
          a = this.model.get("data"),
          i = (this.data.row_num = a.rows),
          o = (this.data.col_num = a.columns),
          s = a.grid_size,
          n = a.layout_mode,
          r = 0;
        "grid_mode" == n
          ? ((this.data.row_num = i = s), (this.data.col_num = o = s))
          : "row_mode" == n
          ? (this.data.col_num = o = 1)
          : "column_mode" == n && (this.data.row_num = i = 1);
        var d = i * o,
          m = this.data.composition.children.length,
          h = d - m;
        if (h < 0)
          for (var l = m - 1; l > d - 1; l--)
            this.data.composition.removeChildAt(l);
        else if (h > 0)
          for (var l = m; l < d; l++)
            (e = new t.Sprite()), this.data.composition.addChild(e);
        for (var l = 0; l < o; l++)
          for (var u = 0; u < i; u++)
            (e = this.data.composition.children[r]),
              (e.anchor = { x: 0.5, y: 0.5 }),
              (e.coords = { x: l, y: u }),
              (e.max_frame = { x: 0, y: 0, w: 1, h: 1 }),
              (e.min_frame = { x: 0, y: 0, w: 1, h: 1 }),
              (e.base_frame = { x: 0, y: 0, w: 1, h: 1 }),
              (e.zoom_in_min_frame = { x: 0, y: 0, w: 1, h: 1 }),
              (e.zoom_in_max_frame = { x: 0, y: 0, w: 1, h: 1 }),
              (e.movement = { x: 0, y: 0 }),
              (e.mouse_over = !1),
              (e.mouse_zoom = 0),
              (e.animating = !1),
              (e.speed = { x: 0, y: 0 }),
              (e.interactive = !0),
              r++;
        this.setSpritePosition(),
          this.resizeImage(),
          $(".loading_animation", this.el).addClass("hidden"),
          Cargo.Event.trigger(this.deferredLoadEventName),
          this.paused && this.in_viewport && this.Resume();
      },
      spriteMouseMove: function () {
        var e = this.model.get("data");
        if (0 != this.data.composition.children.length && e.mouse_interaction) {
          var t,
            a = this.data.row_num,
            i = this.data.col_num,
            o = this.data.backdrop_size.w,
            s = this.data.backdrop_size.h,
            n = this.data.composition.position.x,
            r = this.data.composition.position.y,
            d = this.data.mouse_sensitivity,
            m = [],
            h = 0.01 * e.tolerance,
            h = h * Math.max(a, i) * 2 + 1.5 * (1 - h);
          (t =
            this.data.composition.width / this.data.composition.height > o / s
              ? {
                  x:
                    ((this.data.mouse_cur.x - n) /
                      this.data.composition.width) *
                    i,
                  y: ((this.data.mouse_cur.y - r) / s) * a,
                }
              : {
                  x: ((this.data.mouse_cur.x - n) / o) * i,
                  y:
                    ((this.data.mouse_cur.y - r) /
                      this.data.composition.height) *
                    a,
                }),
            this.data.mouse_vector.unshift(t),
            this.data.mouse_vector.pop();
          var l = 0,
            u = this.data.mouse_vector[0].x,
            c = this.data.mouse_vector[1].x;
          c < u && ((l = u), (u = c), (c = l));
          var _ = this.data.mouse_vector[0].y,
            f = this.data.mouse_vector[1].y;
          f < _ && ((l = _), (_ = f), (f = l));
          for (
            var p,
              x,
              v,
              g,
              y = Math.sqrt(h * h + h * h),
              w = Math.abs(h / y),
              b = this.data.mouse_in ? 1 : this.data.mouse_delta.long_tail,
              z = u + -0.01;
            z < c;
            z++
          )
            for (var M = _ + -0.01; M < f; M++) {
              m = this.data.composition.children.filter(function (e) {
                return (
                  Math.floor(z) <= e.coords.x + h &&
                  Math.floor(z) >= e.coords.x - h &&
                  Math.floor(M) <= e.coords.y + h &&
                  Math.floor(M) >= e.coords.y - h
                );
              });
              for (var C = 0; C < m.length; C++)
                (p = z + -0.5 - m[C].coords.x),
                  (x = M + -0.5 - m[C].coords.y),
                  (v = Math.sqrt(p * p + x * x)),
                  (g = Math.max(h * w - v, 0) / (0.5 * y)),
                  (m[C].mouse_zoom =
                    Math.min(
                      Math.max(
                        0,
                        m[C].mouse_zoom * (1 - g) +
                          (m[C].mouse_zoom + 0.1 * g) * g
                      ),
                      1
                    ) * b),
                  (m[C].speed.x += Math.min(
                    Math.max(-1, this.data.mouse_delta.smooth_x * g * d * 0.1),
                    1
                  )),
                  (m[C].speed.y += Math.min(
                    Math.max(-1, this.data.mouse_delta.smooth_y * g * d * 0.1),
                    1
                  ));
            }
        }
      },
      updateScroll: function () {
        this.data.backdrop_size.top = this.el.getBoundingClientRect().top;
      },
      mouseEnter: function () {
        (this.data.mouse_in = !0),
          (this.data.backdrop_size.left = this.el.getBoundingClientRect().left);
      },
      mouseLeave: function () {
        this.data.mouse_in = !1;
      },
      stirPixels: function () {
        var e = this.model.get("data");
        if (0 != this.data.composition.children.length && e.stir_grid) {
          var t,
            a = this.data.composition.children.length,
            i = (this.data.col_num, this.data.row_num, 0.05 * e.stir_freq),
            o = 0.1 * e.stir_disorder + 1,
            s = 0.001 * e.stir_strength * 0.25,
            n = Math.sin(0.005 * i * this.counter),
            r = Math.cos(0.005 * i * this.counter);
          if ("grid_mode" == e.layout_mode)
            for (var d = 0; d < a; d++)
              (t = this.data.composition.children[d]),
                (r = Math.sin(r + (o - 1) * d * 10)),
                (t.speed.x +=
                  (Math.sin(
                    0.003 * this.counter * i +
                      0.1 * (t.coords.x + r * t.coords.y * 0.5 * o)
                  ) *
                    r +
                    Math.cos(
                      -0.0031 * this.counter * i +
                        -0.1 * (t.coords.x - r * t.coords.y * 0.5 * o) +
                        0.7
                    ) *
                      n) *
                  s),
                (t.speed.y +=
                  (Math.sin(
                    0.0031 * this.counter * i +
                      0.1 * (t.coords.y - r * t.coords.x * 0.5 * o)
                  ) *
                    r +
                    Math.cos(
                      -0.003 * this.counter * i +
                        -0.1 * (t.coords.y - r * t.coords.x * 0.5 * o) +
                        0.7
                    ) *
                      n) *
                  s);
          else
            for (var d = 0; d < a; d++)
              (t = this.data.composition.children[d]),
                (r = Math.sin(r + (o - 1) * d * 10)),
                (t.speed.x +=
                  (Math.sin(
                    0.009 * this.counter * i +
                      0.1 * (t.coords.x + r * t.coords.y * 0.5 * o * 40)
                  ) *
                    r +
                    Math.cos(
                      -0.0091 * this.counter * i +
                        -0.1 * (t.coords.x - r * t.coords.y * 0.5 * o * 40) +
                        0.7
                    ) *
                      n) *
                  s *
                  2),
                (t.speed.y +=
                  (Math.sin(
                    0.0091 * this.counter * i +
                      0.1 * (t.coords.y - r * t.coords.x * 0.5 * o * 40)
                  ) *
                    r +
                    Math.cos(
                      -0.009 * this.counter * i +
                        -0.1 * (t.coords.y - r * t.coords.x * 0.5 * o * 40) +
                        0.7
                    ) *
                      n) *
                  s *
                  2);
        }
      },
      animateFrame: function () {
        if (
          this.data.image_loaded &&
          0 != this.data.composition.children.length
        )
          for (
            var e,
              a,
              i,
              o,
              s,
              n,
              r = 0.01 * this.model.get("data").mouse_zoom,
              d = this.data.composition.children.length,
              m = (this.data.col_num, this.data.row_num),
              h = 0,
              l = { x: 0, y: 0 },
              u = 0,
              c = 0,
              _ = 1 - (0.15 * this.data.elasticity) / 100,
              f = 0.5 * (1 - this.data.elasticity / 100) + 0.49,
              p = 0;
            p < d;
            p++
          ) {
            (e = this.data.composition.children[p]),
              (e.speed.x = Math.min(1, Math.max(-1, e.speed.x * _))),
              (e.speed.y = Math.min(1, Math.max(-1, e.speed.y * _)));
            var x = p + m,
              v = p - m,
              g = p + 1,
              y = p - 1;
            (h = 0),
              (l = { x: 0, y: 0 }),
              0 != Math.floor(g % m) &&
                ((l.x += this.data.composition.children[g].movement.x),
                (l.y += this.data.composition.children[g].movement.y),
                h++),
              Math.floor(y % m) != m - 1 &&
                Math.floor(y % m) > -1 &&
                ((l.x += this.data.composition.children[y].movement.x),
                (l.y += this.data.composition.children[y].movement.y),
                h++),
              x < d &&
                ((l.x += this.data.composition.children[x].movement.x),
                (l.y += this.data.composition.children[x].movement.y),
                h++),
              v >= 0 &&
                ((l.x += this.data.composition.children[v].movement.x),
                (l.y += this.data.composition.children[v].movement.y),
                h++),
              h > 0 &&
                ((e.movement.x = (l.x / h) * f + e.speed.x * (1 - f)),
                (e.movement.y = (l.y / h) * f + e.speed.y * (1 - f))),
              (u = Math.abs(e.movement.x)),
              (c = Math.abs(e.movement.y));
            var w,
              b,
              z = 0.5 * e.movement.x + 0.5,
              M = 0.5 * e.movement.y + 0.5;
            (i =
              (e.max_frame.x * (1 - z) + e.min_frame.x * z) * u +
              e.base_frame.x * (1 - u)),
              (o =
                (e.max_frame.y * (1 - M) + e.min_frame.y * M) * c +
                e.base_frame.y * (1 - c)),
              e.movement.x > 0
                ? ((i = e.min_frame.x * u + e.base_frame.x * (1 - u)),
                  (w =
                    e.zoom_in_min_frame.x * u +
                    e.zoom_in_frame_base.x * (1 - u)))
                : ((i = e.max_frame.x * u + e.base_frame.x * (1 - u)),
                  (w =
                    e.zoom_in_max_frame.x * u +
                    e.zoom_in_frame_base.x * (1 - u))),
              e.movement.y > 0
                ? ((o = e.min_frame.y * c + e.base_frame.y * (1 - c)),
                  (b =
                    e.zoom_in_min_frame.y * c +
                    e.zoom_in_frame_base.y * (1 - c)))
                : ((o = e.max_frame.y * c + e.base_frame.y * (1 - c)),
                  (b =
                    e.zoom_in_max_frame.y * c +
                    e.zoom_in_frame_base.y * (1 - c))),
              (s = e.base_frame.w),
              (n = e.base_frame.h);
            var C = e.mouse_zoom * Math.abs(r),
              k = 0.5 * r + 0.5;
            (i = (1 - C) * i + C * ((1 - k) * e.zoom_out_frame.x + k * w)),
              (o = (1 - C) * o + C * ((1 - k) * e.zoom_out_frame.y + k * b)),
              (s =
                (1 - C) * s +
                C *
                  ((1 - k) * e.zoom_out_frame.w + k * e.zoom_in_frame_base.w)),
              (n =
                (1 - C) * n +
                C *
                  ((1 - k) * e.zoom_out_frame.h + k * e.zoom_in_frame_base.h)),
              (e.mouse_zoom = Math.max(0.95 * e.mouse_zoom, 0)),
              (u > 1e-5 || c > 1e-5 || C > 1e-4) &&
                ((a = new t.Rectangle(i, o, s, n)),
                (e.texture = new t.Texture(this.data.texture.baseTexture, a)));
          }
      },
      setSpritePosition: function () {
        var e = this.model.get("data");
        if (
          this.data.image_loaded &&
          0 != this.data.composition.children.length
        ) {
          var a,
            i,
            o,
            s,
            n,
            r,
            d,
            m,
            h,
            l,
            u,
            c,
            _,
            f,
            p,
            x,
            v,
            g,
            y,
            w,
            a,
            b = this.data.texture_size.width,
            z = this.data.texture_size.height,
            M = e.rows,
            C = e.columns,
            k = e.grid_size,
            I = e.layout_mode,
            E = 0,
            L = 0,
            P = 0.01 * e.zoom,
            T = e.flip_it,
            S = [];
          T
            ? "grid_mode" == I
              ? (S = [
                  [-1, 1],
                  [-1, 1],
                ])
              : "row_mode" == I
              ? (S = [
                  [1, 1],
                  [-1, 1],
                ])
              : "column_mode" == I &&
                (S = [
                  [-1, 1],
                  [1, 1],
                ])
            : (S = [
                [1, 1],
                [1, 1],
              ]),
            "grid_mode" == I
              ? ((M = k),
                (C = k),
                (E = Math.max(1 - ((k - 3) / 29) * 2, 0)),
                (L = 0.5 * (1 - (k - 3) / 29) + 0.5),
                P < 0 && (P *= L),
                (h_zoom = P),
                (v_zoom = P),
                (f = tex_cell_w = b / (C + 2)),
                (p = tex_cell_h = z / (M + 2)))
              : "row_mode" == I
              ? ((C = 1),
                (E = Math.max(1 - ((M - 3) / 59) * 2, 0)),
                (L = 0.5 * (1 - (M - 3) / 59) + 0.5),
                P < 0 && (P *= L),
                (h_zoom = 0),
                (v_zoom = P),
                (tex_cell_w = b),
                (f = 0),
                (p = tex_cell_h = z / (M + 2)),
                (tex_cell_h = z / (M + 2)))
              : "column_mode" == I &&
                ((M = 1),
                (E = Math.max(1 - ((C - 3) / 59) * 2, 0)),
                (L = 0.5 * (1 - (C - 3) / 59) + 0.5),
                P < 0 && (P *= L),
                (h_zoom = P),
                (v_zoom = 0),
                (tex_cell_w = b / (C + 2)),
                (f = tex_cell_w = b / (C + 2)),
                (p = 0),
                (tex_cell_h = z));
          for (var s = 1 / b, n = 1 / z, R = 0; R < M * C; R++)
            (w = this.data.composition.children[R]),
              (x = 1 == C ? 0.5 : w.coords.x / (C - 1)),
              (v = 1 == M ? 0.5 : w.coords.y / (M - 1)),
              (g = Math.sin(x * Math.PI)),
              (y = Math.sin(v * Math.PI)),
              (m = f + 1 / b),
              (h = p + 1 / z),
              (r = f + w.coords.x * tex_cell_w),
              (d = p + w.coords.y * tex_cell_h),
              (i = r + tex_cell_w / 2 + 0.5 * -s),
              (o = d + tex_cell_h / 2 + 0.5 * -n),
              h_zoom > 0
                ? ((l = h_zoom * i + (1 - h_zoom) * r),
                  (c = h_zoom * s + (1 - h_zoom) * m))
                : ((l = -h_zoom * tex_cell_w + (1 + h_zoom) * r),
                  (c = -h_zoom * (b - 2 * tex_cell_w) + (1 + h_zoom) * m)),
              v_zoom > 0
                ? ((u = v_zoom * o + (1 - v_zoom) * d),
                  (_ = v_zoom * n + (1 - v_zoom) * h))
                : ((u = -v_zoom * tex_cell_h + (1 + v_zoom) * d),
                  (_ = -v_zoom * (z - 2 * tex_cell_h) + (1 + v_zoom) * h)),
              "grid_mode" == I
                ? ((w.min_frame = {
                    x: Math.max(
                      0,
                      (l - 0.5 * b * g) * (1 - E) + (l - 0.5 * b) * E
                    ),
                    y: Math.max(
                      0,
                      (u - 0.5 * z * y) * (1 - E) + (u - 0.5 * z) * E
                    ),
                    w: c,
                    h: _,
                  }),
                  (w.max_frame = {
                    x: Math.min(
                      (l + 0.5 * b * g) * (1 - E) + (l + 0.5 * b) * E,
                      b - c
                    ),
                    y: Math.min(
                      (u + 0.5 * z * y) * (1 - E) + (u + 0.5 * z) * E,
                      z - _
                    ),
                    w: c,
                    h: _,
                  }),
                  (w.base_frame = { x: l, y: u, w: c, h: _ }),
                  (w.zoom_in_frame_base = { x: i, y: o, w: s, h: n }),
                  (w.zoom_in_min_frame = { x: 0, y: 0, w: s, h: n }),
                  (w.zoom_in_max_frame = { x: b - s, y: z - o, w: s, h: n }),
                  (w.zoom_out_frame = { x: 0, y: 0, w: b, h: z }))
                : "row_mode" == I
                ? ((w.min_frame = {
                    x: 0,
                    y: Math.max(
                      0,
                      (u - 0.5 * z * y) * (1 - E) + (u - 0.5 * z) * E
                    ),
                    w: b,
                    h: _,
                  }),
                  (w.max_frame = {
                    x: 0,
                    y: Math.min(
                      (u + 0.5 * z * y) * (1 - E) + (u + 0.5 * z) * E,
                      z - _
                    ),
                    w: b,
                    h: _,
                  }),
                  (w.base_frame = { x: 0, y: u, w: b, h: _ }),
                  (w.zoom_in_frame_base = { x: 0, y: o, w: b, h: n }),
                  (w.zoom_in_min_frame = { x: 0, y: 0, w: b, h: n }),
                  (w.zoom_in_max_frame = { x: 0, y: z - o, w: b, h: n }),
                  (w.zoom_out_frame = { x: 0, y: 0, w: b, h: z }))
                : "column_mode" == I &&
                  ((w.min_frame = {
                    x: Math.max(
                      0,
                      (l - 0.5 * b * g) * (1 - E) + (l - 0.5 * b) * E
                    ),
                    y: 0,
                    w: c,
                    h: z,
                  }),
                  (w.max_frame = {
                    x: Math.min(
                      (l + 0.5 * b * g) * (1 - E) + (l + 0.5 * b) * E,
                      b - c
                    ),
                    y: 0,
                    w: c,
                    h: z,
                  }),
                  (w.base_frame = { x: l, y: 0, w: c, h: z }),
                  (w.zoom_in_frame_base = { x: i, y: 0, w: s, h: z }),
                  (w.zoom_in_min_frame = { x: 0, y: 0, w: s, h: z }),
                  (w.zoom_in_max_frame = { x: b - s, y: 0, w: s, h: z }),
                  (w.zoom_out_frame = { x: 0, y: 0, w: b, h: z })),
              (a = new t.Rectangle(
                w.base_frame.x,
                w.base_frame.y,
                w.base_frame.w,
                w.base_frame.h
              )),
              (w.texture = new t.Texture(this.data.texture.baseTexture, a)),
              (w.width =
                (this.data.backdrop_size.w / C) * S[0][w.coords.x % 2]),
              (w.height =
                (this.data.backdrop_size.h / M) * S[1][w.coords.y % 2]),
              (w.position = {
                x: Math.abs(w.width * w.coords.x) + 0.5 * Math.abs(w.width),
                y: Math.abs(w.height * w.coords.y) + 0.5 * Math.abs(w.height),
              });
        }
      },
      resizeImage: function () {
        if (this.data.image_loaded) {
          var e = (this.data.image_size.height, this.data.image_size.width, 0),
            t = 0,
            a = 0,
            i = 0,
            o = null,
            s = {
              h: this.data.backdrop_size.h + 4,
              w: this.data.backdrop_size.w + 4,
            },
            n = {
              y: this.data.image_size.width / this.data.image_size.height,
              x: this.data.image_size.height / this.data.image_size.width,
            };
          (o = s.w / s.h < n.y),
            o
              ? ((e = Math.ceil(s.h)), (t = Math.ceil(s.h * n.y)))
              : ((e = Math.ceil(s.w * n.x)), (t = Math.ceil(s.w))),
            (a = Math.ceil((s.h - e) / 2 - 2)),
            (i = Math.ceil((s.w - t) / 2 - 2)),
            (this.data.composition.width = t),
            (this.data.composition.height = e),
            (this.data.composition.x = i),
            (this.data.composition.y = a);
        }
      },
      changeBGColor: function () {
        var e = this.model.get("data");
        (this.data.renderer.backgroundColor = e.hex.replace("#", "0x")),
          (this.data.stage.alpha = 1 - e.alpha);
      },
      updateMouseOffset: function (e) {
        if (!this.mouse_calced && this.model.get("data").mouse_interaction) {
          if (
            ((this.data.mouse_prev = {
              x: this.data.mouse_cur.x,
              y: this.data.mouse_cur.y,
            }),
            this.data.is_mobile && e)
          )
            this.data.mouse_cur = {
              x:
                (e.layerX || e.touches[0].clientX) -
                this.data.backdrop_size.left,
              y:
                (e.layerY || e.touches[0].clientY) -
                this.data.backdrop_size.top,
            };
          else if (e) {
            if (
              this.data.lastClientPos.x === e.clientX &&
              this.data.lastClientPos.y === e.clientY
            )
              return;
            (this.data.lastClientPos.x = e.clientX),
              (this.data.lastClientPos.y = e.clientY),
              (this.data.mouse_in = !0),
              (this.data.mouse_cur = {
                x: e.clientX - this.data.backdrop_size.left,
                y: e.clientY - this.data.backdrop_size.top,
              });
          }
          this.mouse_calced = !0;
        }
      },
      setMouseDelta: function () {
        var e = {
          x: this.data.mouse_cur.x - this.data.mouse_prev.x,
          y: this.data.mouse_cur.y - this.data.mouse_prev.y,
        };
        if (
          !(
            Math.abs(e.x) > 0.9 * this.data.backdrop_size.w ||
            Math.abs(e.y) > 0.9 * this.data.backdrop_size.h
          )
        )
          if (
            (this.data.mouse_cache.x == this.data.mouse_cur.x &&
              ((this.data.mouse_prev.x = this.data.mouse_cur.x), (e.x = 0)),
            this.data.mouse_cache.y == this.data.mouse_cur.y &&
              ((this.data.mouse_prev.y = this.data.mouse_cur.y), (e.y = 0)),
            (this.data.mouse_cache.x = this.data.mouse_cur.x),
            (this.data.mouse_cache.y = this.data.mouse_cur.y),
            -1 == this.data.mouse_prev.x)
          )
            this.data.mouse_delta = {
              x: 0,
              y: 0,
              smooth_x: 0,
              smooth_y: 0,
              long_tail: 0,
            };
          else {
            var t = {
              x: this.data.mouse_delta.smooth_x,
              y: this.data.mouse_delta.smooth_y,
              long_tail: this.data.mouse_delta.long_tail,
            };
            (this.data.mouse_delta = {
              x: e.x,
              y: e.y,
              smooth_x: 0.1 * this.data.mouse_delta.x + 0.9 * t.x,
              smooth_y: 0.1 * this.data.mouse_delta.y + 0.9 * t.y,
              long_tail: 1,
            }),
              this.data.mouse_in
                ? (this.data.mouse_delta.long_tail = 1)
                : (this.data.mouse_delta.long_tail = Math.min(
                    0.008 *
                      Math.max(
                        Math.abs(this.data.mouse_delta.x),
                        Math.abs(this.data.mouse_delta.y)
                      ) +
                      0.992 * t.long_tail,
                    1
                  ));
          }
      },
      updateWindow: function (e) {
        var t = this.$el.closest(".backdrop").get(0);
        if (null !== t && void 0 !== t && null !== this.data.renderer) {
          var a = Math.max(t.offsetWidth, 1),
            i = Math.max(t.offsetHeight, 1);
          (this.data.backdrop_size.w == a &&
            this.data.backdrop_size.h == i &&
            2 == this.data.backdrop_size.resolution &&
            1 != e) ||
            ((this.data.backdrop_size.w = a),
            (this.data.backdrop_size.h = i),
            (this.data.backdrop_size.left = t.offsetLeft),
            (this.data.backdrop_size.resolution = 2),
            this.data.renderer.resize(a, i),
            this.resizeImage());
        }
      },
      Pause: function () {
        window.cancelAnimationFrame(this.drawFrameID), (this.paused = !0);
      },
      Resume: function () {
        window.cancelAnimationFrame(this.drawFrameID),
          this.inited && (this.draw(), (this.paused = !1));
      },
      counter: 0,
      draw: function () {
        var e = this;
        (this.drawFrameID = window.requestAnimationFrame(function () {
          e.draw();
        })),
          this.updateWindow(),
          this.setMouseDelta(),
          this.stirPixels(),
          this.spriteMouseMove(),
          this.animateFrame(),
          this.counter++,
          this.data.renderer.render(this.data.stage),
          (this.mouse_calced = !1);
      },
      Init: function () {
        var e = document.getElementsByTagName("body")[0],
          a = this.model.get("data");
        void 0 == a.image &&
          ((a.image = this.defaults.image), this.model.set("data", a)),
          (this.data.renderer = t.autoDetectRenderer(800, 600, {
            resolution: 2,
          })),
          (this.data.stage = new t.Container()),
          (this.data.composition = new t.Container()),
          this.data.stage.addChild(this.data.composition),
          this.loadImage(),
          this.el.appendChild(this.data.renderer.view),
          this.data.renderer.view.classList.add("canvas_pixelation"),
          this.changeBGColor(),
          Cargo.Helper.isMobile()
            ? ((this.data.is_mobile = !0),
              window.addEventListener("touchmove", this.mouseCallback),
              (this.data.mouse_in = !1))
            : (window.addEventListener("mousemove", this.mouseCallback),
              e.addEventListener("mouseenter", this.mouseEnterCallback),
              e.addEventListener("mouseleave", this.mouseLeaveCallback)),
          window.addEventListener("scroll", this.scrollCallback),
          (this.data.elasticity = a.elasticity),
          (this.data.mouse_sensitivity =
            0.05 * Math.pow(0.01 * a.mouse_sensitivity, 2)),
          this.updateWindow(!0),
          (this.inited = !0),
          this.in_viewport ? this.Resume() : this.Pause();
      },
      Update: function (e, t) {
        var a = this.model.get("data");
        if (t != a[e]) {
          if (
            ((a[e] = t),
            this.model.set("data", a),
            "image" == e && ((this.data.image_loaded = !1), this.loadImage()),
            "image_delete" == e &&
              a.image == t &&
              ((a.image = ""), this.model.set("data", a), this.loadImage()),
            "rows" == e ||
              "columns" == e ||
              "grid_size" == e ||
              "layout_mode" == e ||
              "flip_it" == e)
          ) {
            if (!this.data.image_loaded) return;
            this.makeSprites();
          }
          "zoom" == e && (this.setSpritePosition(), this.resizeImage()),
            "elasticity" == e && (this.data.elasticity = t),
            ("hex" != e && "alpha" != e) || this.changeBGColor(),
            "mouse_sensitivity" == e &&
              (this.data.mouse_sensitivity =
                0.05 * Math.pow(0.01 * a.mouse_sensitivity, 2));
        }
      },
      destroy: function () {
        this.image_load_queue = [];
        var e = document.getElementsByTagName("body")[0];
        window.cancelAnimationFrame(this.drawFrameID),
          window.removeEventListener("mousemove", this.mouseCallback),
          window.removeEventListener("touchmove", this.mouseCallback),
          e.removeEventListener("mouseenter", this.mouseEnterCallback),
          e.removeEventListener("mouseleave", this.mouseLeaveCallback),
          window.removeEventListener("scroll", this.scrollCallback),
          (this.data.stage = null),
          this.data.renderer.destroy(),
          (this.loadImage = null),
          (this.data = null),
          (this.destroyed = !0);
      },
    });
  }),
  (Backdrop.Data.require_loaded = !0),
  (function (e) {
    var t = document,
      a = "appendChild",
      i = "styleSheet",
      o = t.createElement("style");
    (o.type = "text/css"),
      t.getElementsByTagName("head")[0][a](o),
      o[i] ? (o[i].cssText = e) : o[a](t.createTextNode(e));
  })(
    '[data-backdrop="pixelation"].backdrop > div {\n\topacity: 0;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n\n[data-backdrop="pixelation"] .canvas_pixelation {\n\tpointer-events: none;\n\tbackground-color: #000;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n'
  );
